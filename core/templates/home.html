{% extends 'base.html' %}

{% block title %}Define.me - {{ user.username }}{% endblock %}

{% block content %}

<!--jQuery AJAX to update questions-->
<script>
$(document).ready(function(){
    console.log('jQuery is working'); //sanity check
    $('.update-question-form').submit(function(event){
        event.preventDefault();
        console.log('Form submitted'); //sanity check
        var question_id = $(this).find("input[type=submit]").val();
        console.log(question_id);
        update_question(this, question_id);
    });
});

function update_question(event, question_id){
    console.log('Starting update_question() function, question id = ' + question_id); //sanity check
    console.log($(event).find("input[type=text]").val()); //sanity check
     $.ajax(
        url = "/ajax/update_question",
        type = "POST",
        data = {
            csrfmiddlewaretoken: '{{ csrf_token }}',
        },
    );
};


</script>

<h2>{{ user.username }} is logged in</h2>
<a href="{% url 'logout' %}">Logout</a>
<a href="{% url 'create_question' %}">Create question</a>
{% if questions %}
<table>
    <tr>
        <th>Edit</th>
        <th>Question</th>
        <th>Answer</th>
        <th>Tag</th>
        <th>Priority</th>
        <th>Created at</th>
        <th>Delete</th>
    </tr>
    {% for question in questions %}
    <tr>
        <td>
            <a href="{% url 'edit_question' question.id %}">Edit</a>
        </td>
        <td>
            <form class="update-question-form">
                {% csrf_token %}
                <input type="text" value="{{ question.q }}"/>
                <input type="submit" value="{{ question.id }}" style="display:none;"/>
            </form>
        </td>
        <td>
            {% if not question.a %}
            <form method="post">
                {% csrf_token %}
                <input type="hidden" name="id" value="{{ question.id }}"/>
                <input type="text" name="a" placeholder="Answer"/>
                <input type="submit" value="save"/>
            </form>
            {% endif %}
            {{ question.a }}
        </td>
        <td>
            {% if question.tag %}
            <a href="{% url 'show_tag' question.tag %}">
                {{ question.tag }}
            </a>
            {% endif %}
        </td>
        <td>{{ question.priority|floatformat }}</td>
        <td>{{ question.created_at }}</td>
        <td>
            <form method='post' action="{% url 'delete_question' %}">
                {% csrf_token %}
                <input type="hidden" name="id" value="{{ question.id }}"/>
                <input name="submit" type="submit" value="Delete">
            </form>
        </td>
    </tr>
    {% endfor %}
    <tr></tr>
</table>
{% endif %}

{% endblock %}